<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://oldcamel.run</id>
    <title>Old Camel</title>
    <updated>2021-05-31T09:14:10.832Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://oldcamel.run"/>
    <link rel="self" href="https://oldcamel.run/atom.xml"/>
    <subtitle>æ—¥å¸¸å¼€å‘è®°å½• 
&lt;div&gt;&lt;iframe frameborder=&quot;no&quot; border=&quot;0&quot; marginwidth=&quot;0&quot; marginheight=&quot;0&quot; width=330 height=86 src=&quot;//music.163.com/outchain/player?type=2&amp;id=18611643&amp;auto=1&amp;height=66&quot;&gt;&lt;/iframe&gt;&lt;/div&gt;</subtitle>
    <logo>https://oldcamel.run/images/avatar.png</logo>
    <icon>https://oldcamel.run/favicon.ico</icon>
    <rights>All rights reserved 2021, Old Camel</rights>
    <entry>
        <title type="html"><![CDATA[4.0 æ–°çš„å¼€ç«¯]]></title>
        <id>https://oldcamel.run/post/40-xin-de-kai-duan/</id>
        <link href="https://oldcamel.run/post/40-xin-de-kai-duan/">
        </link>
        <updated>2021-05-31T08:22:46.000Z</updated>
        <content type="html"><![CDATA[<p>åˆåˆåˆåˆå¼€å§‹æ­å»ºæ–°æ¡†æ¶äº†,è¿™æ¬¡å¼€æå¤šç§Ÿæˆ·äº‘æœåŠ¡ã€‚</p>
<table>
<thead>
<tr>
<th>åˆæ­¥è®¡åˆ’åˆ—è¡¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>stars-spring-boot-starter  å¤šæ•°æ®æº  jpa+mybatis</td>
</tr>
<tr>
<td>stars-spring-boot-starter  mybatis æ¢æˆmybatisplus</td>
</tr>
<tr>
<td>stars-spring-boot-starter  liquibaseåˆæ­¥é›†æˆï¼ˆå¤šæ•°æ®æºåœ¨å¯åŠ¨æ—¶åˆ·æ–°åº“ï¼‰</td>
</tr>
<tr>
<td>è®¤è¯ä¸­å¿ƒ å‡çº§ 2.5.0  spring-cloud-oauth2æ¢æˆ spring-security  oauth2</td>
</tr>
<tr>
<td>è®¤è¯ä¸­å¿ƒ jpaåœ¨pgsqlé‡Œè¿è¡Œ, è°ƒè¯•åŠŸèƒ½</td>
</tr>
<tr>
<td>stars-spring-boot-starter  æ·»åŠ é€šç”¨è®¾ç½®+å·¥å…·ç±»+pomä¾èµ–ï¼ˆä¾èµ–é¡¹ç›®pomç²¾ç®€ï¼‰</td>
</tr>
<tr>
<td>stars-archetype mavenæ¨¡æ¿é¡¹ç›®é‡æ–°ä¿®æ”¹</td>
</tr>
<tr>
<td>k8s rookå®‰è£…cephfsï¼Œæµ‹è¯•pvcåŠ¨æ€åŠ¨æ€æŒ‚è½½ï¼Œs3å‚¨å­˜</td>
</tr>
<tr>
<td>pgsql helmç‰ˆæœ¬</td>
</tr>
<tr>
<td>åŸºäºmasteræ•°æ®æºåšç§Ÿæˆ·ç®¡ç†åŠŸèƒ½ã€‚ç§Ÿæˆ·æ•°æ®è°ƒæ•´-&gt;åŠ¨æ€å¢å‡æ•°æ®æº-&gt;liquibaseåˆå§‹åŒ–åº“ï¼ˆå‘å¸ƒè®¢é˜…ï¼‰</td>
</tr>
<tr>
<td>æ–‡ä»¶ä¸­å¿ƒ mongoå­˜å‚¨ä¿®æ”¹ä¸º cephfså­˜å‚¨ ï¼ˆminioï¼‰</td>
</tr>
<tr>
<td>æ¶ˆæ¯ä¸­å¿ƒç­‰å…¶ä»–åŸºç¡€ç»„ä»¶ä¿®æ”¹</td>
</tr>
<tr>
<td>cephfs å¤‡ä»½è„šæœ¬</td>
</tr>
</tbody>
</table>
<h2 id="stars-spring-boot-starter-å¤šæ•°æ®æº-jpamybatis">stars-spring-boot-starter  å¤šæ•°æ®æº  jpa+mybatis</h2>
<p>å¤šç§Ÿæˆ·ç³»ç»Ÿ,æ•°æ®åº“æŒ‰ç§Ÿæˆ·åŒºåˆ†æ•°æ®æºã€‚è®¡åˆ’æ¯ä¸ªç§Ÿæˆ·å•ç‹¬æ•°æ®æºéƒ¨ç½²ï¼Œæ‰€ä»¥å…ˆæä¸ªå¯åŠ¨å™¨é…ç½®å¤šæ•°æ®æºã€‚<br>
å¤šæ•°æ®æºå®ç°:ç»§æ‰¿AbstractRoutingDataSourceï¼Œé‡å†™determineCurrentLookupKeyæ–¹æ³• è¿”å›è‡ªå®šä¹‰çš„keyã€‚è¿™ä¸ªkey ç”¨æ‹¦æˆªå™¨åœ¨è¯·æ±‚å¤´é‡Œè·å–ç”¨æˆ·çš„ç§Ÿæˆ·å€¼æ”¾åˆ°ä¸€ä¸ªçº¿ç¨‹å˜é‡é‡Œã€‚</p>
<ul>
<li>æ‹¦æˆªå™¨</li>
</ul>
<pre><code class="language-java">public class TenantInterceptor implements HandlerInterceptor {
    final String X_TENANT_ID = &quot;X_TenantID&quot;;
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        final String tenantId = request.getHeader(X_TENANT_ID);
        if (tenantId != null) {
            DynamicDataSourceContextHolder.setDataSourceKey(tenantId);
        }
        return true;
    }

    @Override
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {
        DynamicDataSourceContextHolder.clearDataSourceKey();
    }
}

@Configuration
public class TenantConfig implements WebMvcConfigurer {
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        //æŒ‡å®šæ‹¦æˆªå™¨ï¼ŒæŒ‡å®šæ‹¦æˆªè·¯å¾„
        registry.addInterceptor(new TenantInterceptor()).addPathPatterns(&quot;/**&quot;);
    }
}

</code></pre>
<ul>
<li>çº¿ç¨‹å˜é‡</li>
</ul>
<pre><code class="language-java">public class DynamicDataSourceContextHolder {
  private static final ThreadLocal&lt;String&gt; contextHolder = new ThreadLocal&lt;String&gt;() {
      /**
       * å°† master æ•°æ®æºçš„ keyä½œä¸ºé»˜è®¤æ•°æ®æºçš„ key
       */
      @Override
      protected String initialValue() {
          return &quot;master&quot;;
      }
  };

  /**
   * æ•°æ®æºçš„ keyé›†åˆï¼Œç”¨äºåˆ‡æ¢æ—¶åˆ¤æ–­æ•°æ®æºæ˜¯å¦å­˜åœ¨
   */
  public static Set&lt;Object&gt; dataSourceKeys = new HashSet&lt;&gt;();

  /**
   * åˆ‡æ¢æ•°æ®æº
   * @param key  æ•°æ®æº
   */
  public static void setDataSourceKey(String key) {
      if (StringUtils.isNotBlank(key)) {
          contextHolder.set(key);
      }
  }

  /**
   * è·å–æ•°æ®æº
   * @return
   */
  public static String getDataSourceKey() {
      return contextHolder.get();
  }

  /**
   * é‡ç½®æ•°æ®æº
   */
  public static void clearDataSourceKey() {
      contextHolder.remove();
  }

  /**
   * åˆ¤æ–­æ˜¯å¦åŒ…å«æ•°æ®æº
   * @param key   æ•°æ®æº
   * @return
   */
  public static boolean containDataSourceKey(String key) {
      return dataSourceKeys.contains(key);
  }

  /**
   * æ·»åŠ æ•°æ®æºKeys
   * @param keys
   * @return
   */
  public static boolean addDataSourceKeys(Collection&lt;? extends Object&gt; keys) {
      return dataSourceKeys.addAll(keys);
  }
}
</code></pre>
<ul>
<li>é…ç½®æ•°æ®æº</li>
</ul>
<pre><code class="language-java">
 @Bean(&quot;master&quot;)
   @ConfigurationProperties(prefix = &quot;spring.datasource.hikari&quot;)
   public DataSource master(){
       HikariDataSource build = (HikariDataSource)DataSourceBuilder.create().build();
       build.setTransactionIsolation(&quot;TRANSACTION_READ_COMMITTED&quot;);
       return build;
   }
   @Bean
   @Primary
   public DataSource dataSource(){
       DynamicDataSource dynamicDataSource = new DynamicDataSource();
       HashMap&lt;Object, Object&gt; dataSourceMap = new HashMap&lt;&gt;();
       dataSourceMap.put(&quot;master&quot;,master());
       dynamicDataSource.setDefaultDataSource(master());
       dynamicDataSource.setDataSources(dataSourceMap);
       dynamicDataSource.afterPropertiesSet();
       return  dynamicDataSource;
   }

</code></pre>
<ul>
<li>å¤šæ•°æ®æºè¯»å–</li>
</ul>
<pre><code class="language-java">@Data
public class DynamicDataSource  extends AbstractRoutingDataSource {
  private final Map&lt;Object, Object&gt; tenantDataSources = new ConcurrentHashMap&lt;&gt;();

  @Override
  protected Object determineCurrentLookupKey() {
      return DynamicDataSourceContextHolder.getDataSourceKey();
  }


  public void setDefaultDataSource(Object defaultDataSource) {
      super.setDefaultTargetDataSource(defaultDataSource);
  }

  public void setDataSources(Map&lt;Object, Object&gt; dataSources) {
      tenantDataSources.putAll(dataSources);
      super.setTargetDataSources(tenantDataSources);
      super.afterPropertiesSet();
      DynamicDataSourceContextHolder.addDataSourceKeys(dataSources.keySet());
  }

}
</code></pre>
<ul>
<li>åˆ›å»ºç§Ÿæˆ·è¡¨</li>
</ul>
<figure data-type="image" tabindex="1"><img src="https://oldcamel.run/post-images/1622451428396.png" alt="" loading="lazy"></figure>
<ul>
<li>å†™ApplicationRunneråœ¨é¡¹ç›®å¯åŠ¨å®Œæˆåæ·»åŠ å¤šç§Ÿæˆ·æ•°æ®æº</li>
</ul>
<pre><code class="language-java">  public class DynamicDataSourceInit implements ApplicationRunner {
    @Autowired
    DynamicDataSource dataSource;
    @Override
    public void run(ApplicationArguments args) throws Exception {
        HikariDataSource hikariDataSource = (HikariDataSource) SpringContextUtils.getBean(&quot;master&quot;);
        Map&lt;Object, Object&gt; resolvedDataSources =new HashMap&lt;&gt;();
        Connection connection = hikariDataSource.getConnection();
        Statement statement = connection.createStatement();
        ResultSet resultSet = statement.executeQuery(&quot;select tenant_id   \&quot;tenantId\&quot;,tenant_name \&quot;tenantName\&quot;,datasource_url \&quot;datasourceUrl\&quot;,datasource_username \&quot;datasourceUsername\&quot;,datasource_password \&quot;datasourcePassword\&quot;,datasource_driver \&quot;datasourceDriver\&quot; from tenant where status=1&quot;);
        List&lt;Tenant&gt; tenants = (ArrayList&lt;Tenant&gt;) this.populate(resultSet, Tenant.class);
        for (Tenant tenant : tenants) {
            HikariDataSource dataSource = new HikariDataSource();
            dataSource.setDriverClassName(tenant.getDatasourceDriver());
            dataSource.setJdbcUrl(tenant.getDatasourceUrl());
            dataSource.setUsername(tenant.getDatasourceUsername());
            dataSource.setPassword(tenant.getDatasourcePassword());
            dataSource.setConnectionTestQuery(&quot;SELECT 1&quot;);
            dataSource.setTransactionIsolation(&quot;TRANSACTION_READ_COMMITTED&quot;);
            dataSource.setDataSourceProperties(hikariDataSource.getDataSourceProperties());
            resolvedDataSources.put(tenant.getTenantId(), dataSource);
        }
        dataSource.setDataSources(resolvedDataSources);
        dataSource.afterPropertiesSet();
        connection.close();
    }
    private    List populate(ResultSet rs , Class clazz) throws SQLException, InstantiationException, IllegalAccessException{
        //ç»“æœé›†çš„å…ƒç´ å¯¹è±¡
        ResultSetMetaData rsmd = rs.getMetaData();
        //è·å–ç»“æœé›†çš„å…ƒç´ ä¸ªæ•°
        int colCount = rsmd.getColumnCount();
        //è¿”å›ç»“æœçš„åˆ—è¡¨é›†åˆ
        List list = new ArrayList();
        //ä¸šåŠ¡å¯¹è±¡çš„å±æ€§æ•°ç»„
        Field[] fields = clazz.getDeclaredFields();
        while(rs.next()){//å¯¹æ¯ä¸€æ¡è®°å½•è¿›è¡Œæ“ä½œ
            Object obj = clazz.newInstance();//æ„é€ ä¸šåŠ¡å¯¹è±¡å®ä½“
            //å°†æ¯ä¸€ä¸ªå­—æ®µå–å‡ºè¿›è¡Œèµ‹å€¼
            for(int i = 1;i&lt;=colCount;i++){
                Object value = rs.getObject(i);
                //å¯»æ‰¾è¯¥åˆ—å¯¹åº”çš„å¯¹è±¡å±æ€§
                for(int j=0;j&lt;fields.length;j++){
                    Field f = fields[j];
                    //å¦‚æœåŒ¹é…è¿›è¡Œèµ‹å€¼
                    if(f.getName().equalsIgnoreCase(rsmd.getColumnName(i))){
                        boolean flag = f.isAccessible();
                        f.setAccessible(true);
                        f.set(obj, value);
                        f.setAccessible(flag);
                    }
                }
            }
            list.add(obj);
        }
        return list;
    }
}
</code></pre>
<h1 id="stars-spring-boot-starter-mybatis-æ¢æˆmybatisplus">stars-spring-boot-starter  mybatis æ¢æˆmybatisplus</h1>
<p>å› ä¸ºéƒ¨åˆ†é¡¹ç›®ç»„ç”¨äº†mybatisplus,åœ¨å¯åŠ¨å™¨é‡ŒæŠŠmybatiså‡çº§æˆmybatisplusï¼Œé‡Œé¢åˆ†é¡µæ’ä»¶ é‡‡ç”¨ pagehelper+mybatisplusè‡ªå¸¦åˆ†é¡µ å¹¶å­˜çš„æ–¹å¼ã€‚</p>
<ul>
<li>æ·»åŠ ä¾èµ–</li>
</ul>
<pre><code class="language-xml"> &lt;dependency&gt;
            &lt;groupId&gt;com.baomidou&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;3.4.3&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.github.pagehelper&lt;/groupId&gt;
            &lt;artifactId&gt;pagehelper-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;1.3.0&lt;/version&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;
                    &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency
</code></pre>
<ul>
<li>mybatisplus+ åˆ†é¡µ é…ç½®</li>
</ul>
<pre><code class="language-java">    @Bean
    @ConfigurationProperties(prefix = &quot;pagehelper&quot;)
    public Properties pageHelperProperties() {
        return new Properties();
    }
   @Bean
    public MybatisSqlSessionFactoryBean sqlSessionFactoryBean() throws Exception {
        MybatisSqlSessionFactoryBean sessionFactory = new MybatisSqlSessionFactoryBean();
        Interceptor[] plugins = new Interceptor[2];
        plugins[0] = mybatisPlusInterceptor();
        plugins[1] = pageHelperInterceptor();
        sessionFactory.setPlugins(plugins);
        sessionFactory.setDataSource(dataSource());
        PathMatchingResourcePatternResolver resolver = new PathMatchingResourcePatternResolver();
        sessionFactory.setMapperLocations(resolver.getResources(&quot;classpath*:**/*Mapper.xml&quot;));
        return sessionFactory;
    }
    @Bean
    public PlatformTransactionManager transactionManager() {
        return new DataSourceTransactionManager(dataSource());
    }
    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor() {
        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
        PaginationInnerInterceptor paginationInnerInterceptor = new PaginationInnerInterceptor(DbType.POSTGRE_SQL);
        BlockAttackInnerInterceptor blockAttackInnerInterceptor = new BlockAttackInnerInterceptor();
        //åˆ†é¡µæ’ä»¶
        interceptor.addInnerInterceptor(paginationInnerInterceptor);
        //é˜²æ­¢å…¨è¡¨æ›´æ–°ä¸åˆ é™¤
        interceptor.addInnerInterceptor(blockAttackInnerInterceptor);
        return interceptor;
    }
    @Bean
    public PageInterceptor pageHelperInterceptor() {
        PageInterceptor interceptor = new PageInterceptor();
        interceptor.setProperties(this.pageHelperProperties());
        return interceptor;
    }
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Kubernetes é—®é¢˜å¤„ç†è®°å½•]]></title>
        <id>https://oldcamel.run/post/kubernetes-wen-ti-chu-li-ji-lu/</id>
        <link href="https://oldcamel.run/post/kubernetes-wen-ti-chu-li-ji-lu/">
        </link>
        <updated>2021-05-26T01:28:44.000Z</updated>
        <content type="html"><![CDATA[<h1 id="1-å¼ºåˆ¶åˆ é™¤namespace">1ã€å¼ºåˆ¶åˆ é™¤namespace</h1>
<p>kubectl get namespace rook-ceph -o json &gt; rook-ceph.json<br>
vim rook-ceph.json<br>
åˆ é™¤specä¸­çš„å†…å®¹<br>
<code>&quot;spec&quot;: { }</code><br>
å¼€å¯kube-proxy   kubectl proxy</p>
<p>å¦å¼€ä¸€ä¸ªsshç™»å½•masterï¼Œæ‰§è¡Œ<br>
<code>curl -k -H &quot;Content-Type: application/json&quot; -X PUT --data-binary @rook-ceph.json http://127.0.0.1:8001/api/v1/namespaces/rook-ceph/finalize</code><br>
æ“ä½œå®ŒæˆğŸ‘Œ</p>
<p>#2ã€kubectl get pod è·å–ä¸åˆ°èµ„æº</p>
<p>å¤§æ¦‚ç‡æ˜¯èŠ‚ç‚¹ç½‘ç»œæ’ä»¶å‡ºç°äº†é—®é¢˜ã€‚é‡å¯istiod æœåŠ¡å°è¯•å°†å…¶è¿è¡Œåœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šè¯•ä¸‹</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Flink Sql å®ç°CDCæ•°æ®å®æ—¶åŒæ­¥ç‰¹æ®Šå¤„ç†]]></title>
        <id>https://oldcamel.run/post/flink-sql-shi-xian-cdc-shu-ju-shi-shi-tong-bu-te-shu-chu-li/</id>
        <link href="https://oldcamel.run/post/flink-sql-shi-xian-cdc-shu-ju-shi-shi-tong-bu-te-shu-chu-li/">
        </link>
        <updated>2021-04-15T01:06:21.000Z</updated>
        <content type="html"><![CDATA[<h1 id="1-decimal-ç±»å‹åœ¨kafkaä¸­è§£æä¸ºä¹±ç ">1ã€decimal ç±»å‹åœ¨kafkaä¸­è§£æä¸ºä¹±ç </h1>
<p>kafka connect æ’ä»¶è®¾ç½® &quot;decimal.handling.mode&quot;: &quot;string&quot; å±æ€§ã€‚å°†decimalè§£æä¸ºå­—ç¬¦ä¸²</p>
<p>sqlè¯­å¥ä¸­å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­— ç”¨CAST(å­—æ®µåç§°) AS INT) å‡½æ•°  INTå¯æ ¹æ®ä¸åŒç±»å‹çš„æ•°å­—æ›¿æ¢ä¸ºä¸åŒçš„ç›®æ ‡ç±»å‹ï¼ˆDECIMAL(10,4) BIGINT ç­‰ï¼‰</p>
<h1 id="2-æ—¥æœŸå¤„ç†">2ã€æ—¥æœŸå¤„ç†</h1>
<p>kafkaä¸­äººæ—¥æœŸç±»å‹ä¼šè§£ææˆæ—¶é—´æˆ³ï¼Œå¯ç”¨TO_TIMESTAMP + FROM_UNIXTIMEåšè½¬æ¢ï¼Œæ³¨æ„å¤„ç†æ—¶åŒºé—®é¢˜</p>
<p>oracleæ—¥æœŸç±»å‹å¤„ç†ç²¾åº¦+æ—¶åŒºï¼š</p>
<pre><code>CREATED_DATETS AS TO_TIMESTAMP(FROM_UNIXTIME(CREATED_DATE/1000/1000-8 * 60 * 60, 'yyyy-MM-dd HH:mm:ss')),
</code></pre>
<p>å…¶ä»–æ•°æ®åº“æ—¥æœŸç±»å‹åªå¤„ç†æ—¥æœŸ</p>
<pre><code>FDateTS AS TO_TIMESTAMP(FROM_UNIXTIME((FDate-8 * 60 * 60 * 1000) / 1000, 'yyyy-MM-dd HH:mm:ss'))
</code></pre>
<h1 id="3-cdcæ•°æ®æ’å…¥è®¾ç½®ä¸»é”®">3ã€cdcæ•°æ®æ’å…¥è®¾ç½®ä¸»é”®</h1>
<pre><code>PRIMARY KEY (AAA,BBB) NOT ENFORCED
</code></pre>
<h1 id="4-kafka-sink-sasl-connectæ’ä»¶è®¾ç½®è®¤è¯">4ã€kafka sink sasl connectæ’ä»¶è®¾ç½®è®¤è¯</h1>
<pre><code>&quot;database.history.producer.sasl.mechanism&quot;: &quot;PLAIN&quot;,
&quot;database.history.producer.sasl.jaas.config&quot;: &quot;org.apache.kafka.common.security.plain.PlainLoginModule required username=\&quot;admin\&quot; password=\&quot;å¯†ç \&quot;;&quot;,
&quot;database.history.producer.security.protocol&quot;: &quot;SASL_PLAINTEXT&quot;,
&quot;database.history.consumer.sasl.jaas.config&quot;: &quot;org.apache.kafka.common.security.plain.PlainLoginModule required username=\&quot;admin\&quot; password=\&quot;å¯†ç \&quot;;&quot;,
&quot;database.history.consumer.security.protocol&quot;: &quot;SASL_PLAINTEXT&quot;,
&quot;database.history.consumer.sasl.mechanism&quot;: &quot;PLAIN&quot;
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Kafkaå®ç°oracleçš„CDCæ•°æ®å®æ—¶å˜æ›´]]></title>
        <id>https://oldcamel.run/post/kafka-shi-xian-oracle-de-cdc-shu-ju-shi-shi-bian-geng/</id>
        <link href="https://oldcamel.run/post/kafka-shi-xian-oracle-de-cdc-shu-ju-shi-shi-bian-geng/">
        </link>
        <updated>2021-04-14T06:02:54.000Z</updated>
        <content type="html"><![CDATA[<h1 id="ä½¿ç”¨å·¥å…·-debezium-oracle-connectororacle-logminer">ä½¿ç”¨å·¥å…·  debezium-oracle-connector,oracle-LogMiner</h1>
<h2 id="1-oracle-è®¾ç½®">1ã€oracle è®¾ç½®</h2>
<h3 id="å¼€å¯å½’æ¡£æ¨¡å¼">å¼€å¯å½’æ¡£æ¨¡å¼</h3>
<pre><code class="language-sqlplus">alter system set db_recovery_file_dest_size = 10G;
alter system set db_recovery_file_dest = '/home/oracle/oradta/recovery_area' scope=spfile;
shutdown immediate
startup mount
alter database archivelog;
alter database open;
archive log list
exit;

ALTER DATABASE ADD SUPPLEMENTAL LOG DATA (ALL) COLUMNS;

</code></pre>
<h4 id="åˆ›å»ºç”¨æˆ·">åˆ›å»ºç”¨æˆ·</h4>
<pre><code>CREATE USER myuser IDENTIFIED BY dbz
   DEFAULT TABLESPACE å‘½åç©ºé—´
   QUOTA UNLIMITED ON å‘½åç©ºé—´
</code></pre>
<h4 id="æˆæƒ">æˆæƒ</h4>
<pre><code>GRANT CREATE SESSION TO myuser;
GRANT CREATE TABLE TO myuser;
GRANT CREATE SEQUENCE TO myuser;
GRANT CREATE TRIGGER TO myuser;
GRANT CREATE SESSION TO myuser;
GRANT SELECT ON V_$DATABASE to myuser;
GRANT FLASHBACK ANY TABLE TO myuser;
GRANT SELECT ANY TABLE TO myuser;
GRANT SELECT_CATALOG_ROLE TO myuser;
GRANT EXECUTE_CATALOG_ROLE TO myuser;
GRANT SELECT ANY TRANSACTION TO myuser;
GRANT CREATE TABLE TO myuser;
GRANT LOCK ANY TABLE TO myuser;
GRANT ALTER ANY TABLE TO myuser;
GRANT CREATE SEQUENCE TO myuser;
GRANT EXECUTE ON DBMS_LOGMNR TO myuser;
GRANT EXECUTE ON DBMS_LOGMNR_D TO myuser;
GRANT SELECT ON V_$LOG TO myuser;
GRANT SELECT ON V_$LOG_HISTORY TO myuser;
GRANT SELECT ON V_$LOGMNR_LOGS TO myuser;
GRANT SELECT ON V_$LOGMNR_CONTENTS TO myuser;
GRANT SELECT ON V_$LOGMNR_PARAMETERS TO myuser;
GRANT SELECT ON V_$LOGFILE TO myuser;
GRANT SELECT ON V_$ARCHIVED_LOG TO myuser;
GRANT SELECT ON V_$ARCHIVE_DEST_STATUS TO myuser;
GRANT SELECT ON SYSTEM.LOGMNR_COL$ TO myuser;
GRANT SELECT ON SYSTEM.LOGMNR_OBJ$ TO myuser;
GRANT SELECT ON SYSTEM.LOGMNR_USER$ TO myuser;
GRANT SELECT ON SYSTEM.LOGMNR_UID$ TO myuser;
</code></pre>
<h2 id="oracleå®¢æˆ·ç«¯è®¾ç½®">oracleå®¢æˆ·ç«¯è®¾ç½®</h2>
<h3 id="ä¸‹è½½">ä¸‹è½½</h3>
<pre><code>wget &quot;https://download.oracle.com/otn_software/linux/instantclient/19600/instantclient-basiclite-linux.x64-19.6.0.0.0dbru.zip&quot; -O /tmp/ic.zipï¼›
unzip /tmp/ic.zip -d  è‡ªå®šä¹‰ç›®å½•
</code></pre>
<h3 id="ç¯å¢ƒå˜é‡">ç¯å¢ƒå˜é‡</h3>
<p>è®¾ç½®LD_LIBRARY_PATH æŒ‡å‘ è‡ªå®šä¹‰ç›®å½•</p>
<h2 id="kafaka-connect-æ’ä»¶è®¾ç½®">kafaka connect æ’ä»¶è®¾ç½®</h2>
<h3 id="ä¸‹è½½-2">ä¸‹è½½</h3>
<pre><code>wget &quot;https://oss.sonatype.org/service/local/artifact/maven/redirect?r=snapshots&amp;g=io.debezium&amp;a=debezium-connector-oracle&amp;v=LATEST&amp;c=plugin&amp;e=tar.gz&quot; -O /tmp/dbz-ora.tgzï¼›
tar -xvf /tmp/dbz-ora.tgz --directory  kafaka æ’ä»¶ç›®å½•
</code></pre>
<h3 id="æ·»åŠ -ojdbc-jaråˆ°æ’ä»¶ç›®å½•">æ·»åŠ  ojdbc jaråˆ°æ’ä»¶ç›®å½•</h3>
<pre><code>      curl https://maven.xwiki.org/externals/com/oracle/jdbc/ojdbc8/12.2.0.1/ojdbc8-12.2.0.1.jar -o ojdbc8-12.2.0.1.jar
</code></pre>
<h2 id="åˆ›å»ºkafka-connect">åˆ›å»ºkafka connect</h2>
<pre><code>curl --location --request POST 'http://localhost:8083/connectors' \
--header 'Content-Type: application/json' \
--data-raw '{
   &quot;name&quot;: &quot;name&quot;,
   &quot;config&quot;: {
       &quot;connector.class&quot; : &quot;io.debezium.connector.oracle.OracleConnector&quot;,
       &quot;tasks.max&quot; : &quot;1&quot;,
       &quot;database.server.name&quot; : &quot;topic&quot;,
       &quot;database.hostname&quot; : &quot;database_host&quot;,
       &quot;database.port&quot; : &quot;1521&quot;,
       &quot;database.user&quot; : &quot;myuser&quot;,
       &quot;database.password&quot; : &quot;dbz&quot;,
       &quot;database.dbname&quot; : &quot;orcl&quot;,
       &quot;database.tablename.case.insensitive&quot;: &quot;true&quot;,
       &quot;database.history.kafka.bootstrap.servers&quot; : &quot;localhost:9092&quot;,
       &quot;database.history.kafka.topic&quot;: &quot;name-h&quot;,
       &quot;table.include.list&quot;:&quot;AAA.BBB,CCC.DDD&quot;,
        &quot;database.history.producer.sasl.mechanism&quot;: &quot;PLAIN&quot;,
       &quot;database.history.producer.sasl.jaas.config&quot;:         &quot;org.apache.kafka.common.security.plain.PlainLoginModule required username=\&quot;admin\&quot; password=\&quot;password\&quot;;&quot;,
   &quot;database.history.producer.security.protocol&quot;: &quot;SASL_PLAINTEXT&quot;,
    &quot;database.history.consumer.sasl.jaas.config&quot;:          &quot;org.apache.kafka.common.security.plain.PlainLoginModule required username=\&quot;admin\&quot;   password=\&quot;password\&quot;;&quot;,
     &quot;database.history.consumer.security.protocol&quot;: &quot;SASL_PLAINTEXT&quot;,
       &quot;database.history.consumer.sasl.mechanism&quot;: &quot;PLAIN&quot;
   }
}'
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[linux å®‰è£…æœåŠ¡å™¨èµ„æºç›‘æ§ prometheusè¿œç¨‹å†™å…¥]]></title>
        <id>https://oldcamel.run/post/linux-an-zhuang-fu-wu-qi-zi-yuan-jian-kong-prometheus-yuan-cheng-xie-ru/</id>
        <link href="https://oldcamel.run/post/linux-an-zhuang-fu-wu-qi-zi-yuan-jian-kong-prometheus-yuan-cheng-xie-ru/">
        </link>
        <updated>2021-03-11T01:07:36.000Z</updated>
        <content type="html"><![CDATA[<h2 id="1å®‰è£…prometheus">1.å®‰è£…prometheus</h2>
<pre><code>wgetÂ -cÂ https://github.com/prometheus/prometheus/releases/download/v2.23.0/prometheus-2.23.0.linux-amd64.tar.gzÂ 
tarÂ zxvfÂ prometheus-2.23.0.linux-amd64.tar.gzÂ Â -CÂ /opt/Â 
cdÂ /opt/Â 
lnÂ -sÂ prometheus-2.23.0.linux-amd64Â prometheusÂ 
catÂ &gt;Â /etc/systemd/system/prometheus.serviceÂ &lt;&lt;EOFÂ 
[Unit]Â 
Description=prometheusÂ 
After=network.targetÂ 
[Service]Â 
Type=simpleÂ 
WorkingDirectory=/opt/prometheusÂ 
ExecStart=/opt/prometheus/prometheusÂ --config.file=/opt/prometheus/prometheus.yml
LimitNOFILE=65536Â 
PrivateTmp=trueÂ 
RestartSec=2Â 
StartLimitInterval=0Â 
Restart=alwaysÂ 
[Install]Â 
WantedBy=multi-user.targetÂ 
EOFÂ 
systemctlÂ daemon-reloadÂ Â 
systemctlÂ enableÂ prometheusÂ 
systemctlÂ startÂ prometheusÂ 

</code></pre>
<h3 id="2é…ç½®prometheus">2.é…ç½®Prometheus</h3>
<pre><code>catÂ &gt;Â /opt/prometheus/prometheus.ymlÂ &lt;&lt;EOFÂ 
#Â myÂ globalÂ configÂ 
global:Â 
Â Â scrape_interval:Â Â Â Â Â 15sÂ #Â SetÂ theÂ scrapeÂ intervalÂ toÂ everyÂ 15Â seconds.Â DefaultÂ isÂ everyÂ 1Â minute.Â 
Â Â evaluation_interval:Â 15sÂ #Â EvaluateÂ rulesÂ everyÂ 15Â seconds.Â TheÂ defaultÂ isÂ everyÂ 1Â minute.Â 
Â Â #Â scrape_timeoutÂ isÂ setÂ toÂ theÂ globalÂ defaultÂ (10s).Â 
  external_labels:
        tenant: &quot;140test&quot;
remote_write:
  - url: &quot;url&quot;
    basic_auth:
      username: ç”¨æˆ·å
      password: å¯†ç 
#Â AlertmanagerÂ configurationÂ 
alerting:Â 
Â Â alertmanagers:Â 
Â Â -Â static_configs:Â 
Â Â Â Â -Â targets:Â 
Â Â Â Â Â Â #Â -Â alertmanager:9093Â 
#Â LoadÂ rulesÂ onceÂ andÂ periodicallyÂ evaluateÂ themÂ accordingÂ toÂ theÂ globalÂ 'evaluation_interval'.Â 
rule_files:Â 
Â Â #Â -Â &quot;first_rules.yml&quot;Â 
Â Â #Â -Â &quot;second_rules.yml&quot;Â 
#Â AÂ scrapeÂ configurationÂ containingÂ exactlyÂ oneÂ endpointÂ toÂ scrape:Â 
#Â HereÂ it'sÂ PrometheusÂ itself.Â 
scrape_configs:Â 
Â Â #Â TheÂ jobÂ nameÂ isÂ addedÂ asÂ aÂ labelÂ `job=&lt;job_name&gt;`Â toÂ anyÂ timeseriesÂ scrapedÂ fromÂ thisÂ config.Â 
Â Â -Â job_name:Â 'servers'Â 
Â Â Â Â file_sd_configs:Â 
Â Â Â Â -Â refresh_interval:Â 61sÂ 
Â Â Â Â Â Â files:Â 
Â Â Â Â Â Â Â Â -Â /opt/prometheus/servers/*.jsonÂ 
EOFÂ 

</code></pre>
<h2 id="3åˆ›å»ºnodeé…ç½®æ–‡ä»¶">3.åˆ›å»ºnodeé…ç½®æ–‡ä»¶</h2>
<pre><code>mkdir -p /opt/prometheus/servers
cd /opt/prometheus/servers
vim json.json
[Â Â Â Â Â 
Â Â Â Â {Â 
Â Â Â Â Â Â Â Â &quot;targets&quot;:Â [Â 
Â Â Â Â Â Â Â Â Â Â Â Â â€œxxx.xxx.xxx.xxx:9100&quot;Â 
Â Â Â Â Â Â Â Â ],Â 
Â Â Â Â Â Â Â Â &quot;labels&quot;:Â {Â 
Â Â Â Â Â Â Â Â Â Â Â Â &quot;instance&quot;:Â &quot;xxx.xxx.xxx.xxx&quot;,Â 
Â Â Â Â Â Â Â Â Â Â Â Â &quot;job&quot;:Â &quot;node_exporter&quot;Â 
Â Â Â Â Â Â Â Â }Â 
Â Â Â Â }
Â Â Â 
]Â 
</code></pre>
<h2 id="å®‰è£…node_exporter">å®‰è£…node_exporter</h2>
<pre><code>Wget https://github.com/prometheus/node_exporter/releases/download/v1.0.1/node_exporter-1.0.1.linux-amd64.tar.gzÂ 
tarÂ zxvfÂ node_exporter-1.0.1.linux-amd64.tar.gzÂ -CÂ /opt/Â 
cdÂ /opt/Â 
lnÂ -sÂ Â node_exporter-1.0.1.linux-amd64Â node_exporterÂ 
catÂ &gt;Â /etc/systemd/system/node_exporter.serviceÂ &lt;&lt;EOFÂ 
[Unit]Â 
Description=node_exporterÂ 
After=network.targetÂ 
[Service]Â 
Type=simpleÂ 
WorkingDirectory=/opt/node_exporterÂ 
ExecStart=/opt/node_exporter/node_exporterÂ 
LimitNOFILE=65536Â 
PrivateTmp=trueÂ 
RestartSec=2Â 
StartLimitInterval=0Â 
Restart=alwaysÂ 
[Install]Â 
WantedBy=multi-user.targetÂ 
EOFÂ 
systemctlÂ daemon-reloadÂ 
systemctlÂ enableÂ node_exporterÂ 
systemctlÂ startÂ node_exporterÂ 
systemctlÂ restartÂ prometheusÂ 

</code></pre>
<h2 id="æŸ¥çœ‹æœåŠ¡æ—¥å¿—å‘½ä»¤">æŸ¥çœ‹æœåŠ¡æ—¥å¿—å‘½ä»¤</h2>
<pre><code>journalctl -u prometheus
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Kafkaå®ç°sqlserverçš„CDCæ•°æ®å®æ—¶å˜æ›´]]></title>
        <id>https://oldcamel.run/post/kafka-shi-xian-sqlserver-de-cdc-shu-ju-shi-shi-bian-geng/</id>
        <link href="https://oldcamel.run/post/kafka-shi-xian-sqlserver-de-cdc-shu-ju-shi-shi-bian-geng/">
        </link>
        <updated>2021-01-08T02:29:39.000Z</updated>
        <content type="html"><![CDATA[<h2 id="å®‰è£…sqlserver">å®‰è£…sqlserver</h2>
<pre><code>#!/bin/bash -e
# Password for the SA user (required)
# è®¾ç½®å¯†ç 
MSSQL_SA_PASSWORD='test@12345678'

# Product ID of the version of SQL server you're installing
# Must be evaluation, developer, express, web, standard, enterprise, or your 25 digit product key
# Defaults to developer
# é€‰æ‹©ç‰ˆæœ¬ï¼Œæœ‰å¤šç§ç‰ˆæœ¬å¯ä¾›åŸåˆ™ï¼Œå…·ä½“ç‰ˆæœ¬æ ‡è¯†ç¬¦å¯è‡ªè¡Œç™¾åº¦
MSSQL_PID='evaluation'

# Install SQL Server Agent (recommended)
SQL_ENABLE_AGENT='y'

# Install SQL Server Full Text Search (optional)
# SQL_INSTALL_FULLTEXT='y'

# Create an additional user with sysadmin privileges (optional)
# æ–°å»ºä¸€ä¸ªé¢å¤–æ·»åŠ çš„ç”¨æˆ·ï¼Œï¼ˆå¯é€‰ï¼‰
# SQL_INSTALL_USER='&lt;Username&gt;'
# SQL_INSTALL_USER_PASSWORD='&lt;YourStrong!Passw0rd&gt;'

if [ -z $MSSQL_SA_PASSWORD ]
then
  echo Environment variable MSSQL_SA_PASSWORD must be set for unattended install
  exit 1
fi

# --------------------------- è¿œç¨‹æ‹‰åŒ… å¹¶å®‰è£…çš„è¿‡ç¨‹
echo Adding Microsoft repositories...
sudo curl -o /etc/yum.repos.d/mssql-server.repo https://packages.microsoft.com/config/rhel/7/mssql-server-2017.repo
sudo curl -o /etc/yum.repos.d/msprod.repo https://packages.microsoft.com/config/rhel/7/prod.repo

echo Installing SQL Server...
sudo yum install -y mssql-server

# --------------------------- ä¸‹é¢ç»™å‡º æœ¬åœ°ç¦»çº¿rpmåŒ…å®‰è£…éƒ¨åˆ†è„šæœ¬
echo ï¼šLocal Installing SQL Server...
sudo yum localinstall -y ./sqlserver2017.rpm



# æ‰§è¡Œsqlserverçš„é…ç½®
echo Running mssql-conf setup...
sudo MSSQL_SA_PASSWORD=$MSSQL_SA_PASSWORD \
     MSSQL_PID=$MSSQL_PID \
     /opt/mssql/bin/mssql-conf -n setup accept-eula

echo Installing mssql-tools and unixODBC developer...
sudo ACCEPT_EULA=Y yum install -y mssql-tools unixODBC-devel

# Add SQL Server tools to the path by default:
echo Adding SQL Server tools to your path...
echo PATH=&quot;$PATH:/opt/mssql-tools/bin&quot; &gt;&gt; ~/.bash_profile
echo 'export PATH=&quot;$PATH:/opt/mssql-tools/bin&quot;' &gt;&gt; ~/.bashrc
source ~/.bashrc

# Optional Enable SQL Server Agent :
if [ ! -z $SQL_ENABLE_AGENT ]
then
  echo Enable SQL Server Agent...
  sudo /opt/mssql/bin/mssql-conf set sqlagent.enabled true
  sudo systemctl restart mssql-server
fi

# Optional SQL Server Full Text Search installation:
if [ ! -z $SQL_INSTALL_FULLTEXT ]
then
    echo Installing SQL Server Full-Text Search...
    sudo yum install -y mssql-server-fts
fi

# Configure firewall to allow TCP port 1433:
# é…ç½®é˜²ç«å¢™æ”¾è¡Œ1433ç«¯å£ï¼Œæ‡’çœäº‹ç›´æ¥å…³æ‰é˜²ç«å¢™äº¦å¯
echo Configuring firewall to allow traffic on port 1433...
sudo firewall-cmd --zone=public --add-port=1433/tcp --permanent
sudo firewall-cmd --reload

# Example of setting post-installation configuration options
# Set trace flags 1204 and 1222 for deadlock tracing:
#echo Setting trace flags...
#sudo /opt/mssql/bin/mssql-conf traceflag 1204 1222 on

# Restart SQL Server after making configuration changes:
# é‡å¯
echo Restarting SQL Server...
sudo systemctl restart mssql-server

# Connect to server and get the version:
# å®˜æ–¹ç»™å‡ºçš„æµ‹è¯•é“¾æ¥è„šæœ¬
counter=1
errstatus=1
while [ $counter -le 5 ] &amp;&amp; [ $errstatus = 1 ]
do
  echo Waiting for SQL Server to start...
  sleep 5s
  /opt/mssql-tools/bin/sqlcmd \
    -S localhost \
    -U SA \
    -P $MSSQL_SA_PASSWORD \
    -Q &quot;SELECT @@VERSION&quot; 2&gt;/dev/null
  errstatus=$?
  ((counter++))
done

# Display error if connection failed:
if [ $errstatus = 1 ]
then
  echo Cannot connect to SQL Server, installation aborted
  exit $errstatus
fi

# Optional new user creation:
if [ ! -z $SQL_INSTALL_USER ] &amp;&amp; [ ! -z $SQL_INSTALL_USER_PASSWORD ]
then
  echo Creating user $SQL_INSTALL_USER
  /opt/mssql-tools/bin/sqlcmd \
    -S localhost \
    -U SA \
    -P $MSSQL_SA_PASSWORD \
    -Q &quot;CREATE LOGIN [$SQL_INSTALL_USER] WITH PASSWORD=N'$SQL_INSTALL_USER_PASSWORD', DEFAULT_DATABASE=[master], CHECK_EXPIRATION=ON, CHECK_POLICY=ON; ALTER SERVER ROLE [sysadmin] ADD MEMBER [$SQL_INSTALL_USER]&quot;
fi

echo Done!
</code></pre>
<p>è¿è¡Œè„šæœ¬ç­‰ç€å®‰è£…å®Œæˆ</p>
<h2 id="å¼€å¯è¡¨çš„cdc">å¼€å¯è¡¨çš„cdc</h2>
<h3 id="åˆ›å»ºshihuæ•°æ®åº“">åˆ›å»ºshihuæ•°æ®åº“</h3>
<h3 id="å»ºæµ‹è¯•è¡¨">å»ºæµ‹è¯•è¡¨</h3>
<pre><code>IF EXISTS (SELECT * FROM sys.all_objects WHERE object_id = OBJECT_ID(N'[dbo].[dt_test]') AND type IN ('U'))
	DROP TABLE [dbo].[dt_test]
GO

CREATE TABLE [dbo].[dt_test] (
  [tid] int  NOT NULL,
  [tname] nvarchar(200) COLLATE SQL_Latin1_General_CP1_CI_AS  NULL,
  [tidcard] nvarchar(200) COLLATE SQL_Latin1_General_CP1_CI_AS  NULL,
  [tbirthday] date  NULL,
  [tmobile] nvarchar(200) COLLATE SQL_Latin1_General_CP1_CI_AS  NULL,
  [temail] nvarchar(200) COLLATE SQL_Latin1_General_CP1_CI_AS  NULL,
  [tgender] bigint  NULL,
  [tcreate_time] datetime  NULL
)
GO

ALTER TABLE [dbo].[dt_test] SET (LOCK_ESCALATION = TABLE)
GO


-- ----------------------------
-- Primary Key structure for table dt_test
-- ----------------------------
ALTER TABLE [dbo].[dt_test] ADD CONSTRAINT [PK__dt_test__DC105B0FA908205A] PRIMARY KEY CLUSTERED ([tid])
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)  
ON [PRIMARY]
GO

</code></pre>
<h3 id="å¼€å¯cdc">å¼€å¯cdc</h3>
<pre><code>USE shihu
GO
EXEC sys.sp_cdc_enable_db
GO

USE shihu
GO
EXEC sys.sp_cdc_enable_table
@source_schema = 'dbo',
@source_name   = â€˜dt_testâ€™,     
@role_name     = NULL,
@filegroup_name = 'PRIMARY',      
@supports_net_changes = 1
GO
</code></pre>
<h2 id="ä¸‹è½½kafkaæ’ä»¶">ä¸‹è½½kafkaæ’ä»¶</h2>
<h3 id="å®˜æ–¹æ–‡æ¡£">å®˜æ–¹æ–‡æ¡£</h3>
<p><a href="https://debezium.io/documentation/reference/1.3/connectors/sqlserver.html">https://debezium.io/documentation/reference/1.3/connectors/sqlserver.html</a></p>
<h3 id="ä¸‹è½½">ä¸‹è½½</h3>
<p><a href="https://repo1.maven.org/maven2/io/debezium/debezium-connector-sqlserver/1.2.5.Final/debezium-connector-sqlserver-1.2.5.Final-plugin.tar.gz">https://repo1.maven.org/maven2/io/debezium/debezium-connector-sqlserver/1.2.5.Final/debezium-connector-sqlserver-1.2.5.Final-plugin.tar.gz</a></p>
<h3 id="åˆ›å»ºæ’ä»¶ç›®å½•">åˆ›å»ºæ’ä»¶ç›®å½•</h3>
<p>åœ¨kafkaè·Ÿç›®å½•åˆ›å»º kafka_connect_plugins ç›®å½•<br>
å°†ä¸‹è½½çš„åŒ…è§£å‹åˆ°æ­¤ç›®å½•ä¸­<br>
<img src="https://oldcamel.run/post-images/1610074594464.png" alt="" loading="lazy"></p>
<h3 id="ä¿®æ”¹kafkaconfigconnect-distributeproperties">ä¿®æ”¹kafka/config/connect-distribute.properties</h3>
<p>bootstrap.servers=IP:9092<br>
plugin.path=Â /kafkaè·¯å¾„/kafka_connect_plugins</p>
<h3 id="å¯åŠ¨kafka-connect">å¯åŠ¨kafka-connect</h3>
<pre><code>./bin/connect-distributed.sh  config/connect-distributed.properties &gt;logs/ksc.log &amp;
</code></pre>
<p>å¼€å¯æˆåŠŸçš„æ ‡å¿—,postmanå¯ä»¥ä½¿ç”¨è®¿é—®ç«¯å£8083ï¼ˆé»˜è®¤çš„ç«¯å£å·,å¯ä»¥åœ¨connect-distributed.properties æ›´æ”¹ï¼‰</p>
<h4 id="rest-api">rest api</h4>
<pre><code>GET /connectors â€“ è¿”å›æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„connectorå
POST /connectors â€“ æ–°å»ºä¸€ä¸ªconnector; è¯·æ±‚ä½“å¿…é¡»æ˜¯jsonæ ¼å¼å¹¶ä¸”éœ€è¦åŒ…å«nameå­—æ®µå’Œconfigå­—æ®µï¼Œnameæ˜¯connectorçš„åå­—ï¼Œconfigæ˜¯jsonæ ¼å¼ï¼Œå¿…é¡»åŒ…å«ä½ çš„connectorçš„é…ç½®ä¿¡æ¯ã€‚
GET /connectors/{name} â€“ è·å–æŒ‡å®šconnetorçš„ä¿¡æ¯
GET /connectors/{name}/config â€“ è·å–æŒ‡å®šconnectorçš„é…ç½®ä¿¡æ¯
PUT /connectors/{name}/config â€“ æ›´æ–°æŒ‡å®šconnectorçš„é…ç½®ä¿¡æ¯
GET /connectors/{name}/status â€“ è·å–æŒ‡å®šconnectorçš„çŠ¶æ€ï¼ŒåŒ…æ‹¬å®ƒæ˜¯å¦åœ¨è¿è¡Œã€åœæ­¢ã€æˆ–è€…å¤±è´¥ï¼Œå¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œè¿˜ä¼šåˆ—å‡ºé”™è¯¯çš„å…·ä½“ä¿¡æ¯ã€‚
GET /connectors/{name}/tasks â€“ è·å–æŒ‡å®šconnectoræ­£åœ¨è¿è¡Œçš„taskã€‚
GET /connectors/{name}/tasks/{taskid}/status â€“ è·å–æŒ‡å®šconnectorçš„taskçš„çŠ¶æ€ä¿¡æ¯
PUT /connectors/{name}/pause â€“ æš‚åœconnectorå’Œå®ƒçš„taskï¼Œåœæ­¢æ•°æ®å¤„ç†çŸ¥é“å®ƒè¢«æ¢å¤ã€‚
PUT /connectors/{name}/resume â€“ æ¢å¤ä¸€ä¸ªè¢«æš‚åœçš„connector
POST /connectors/{name}/restart â€“ é‡å¯ä¸€ä¸ªconnectorï¼Œå°¤å…¶æ˜¯åœ¨ä¸€ä¸ªconnectorè¿è¡Œå¤±è´¥çš„æƒ…å†µä¸‹æ¯”è¾ƒå¸¸ç”¨
POST /connectors/{name}/tasks/{taskId}/restart â€“ é‡å¯ä¸€ä¸ªtaskï¼Œä¸€èˆ¬æ˜¯å› ä¸ºå®ƒè¿è¡Œå¤±è´¥æ‰è¿™æ ·åšã€‚
DELETE /connectors/{name} â€“ åˆ é™¤ä¸€ä¸ªconnectorï¼Œåœæ­¢å®ƒçš„æ‰€æœ‰taskå¹¶åˆ é™¤é…ç½®ã€‚
</code></pre>
<h4 id="æ·»åŠ sqlserver-connect">æ·»åŠ sqlserver connect</h4>
<pre><code>curl --location --request POST 'http://localhost:8083/connectors' \
--header 'Content-Type: application/json' \
--data-raw '{
    &quot;name&quot;: &quot;sqlserver178-connector&quot;,
    &quot;config&quot;: {
        &quot;connector.class&quot;: &quot;io.debezium.connector.sqlserver.SqlServerConnector&quot;,
        &quot;database.hostname&quot;: &quot;sqlserverçš„ip&quot;,
        &quot;database.port&quot;: &quot;1433&quot;,
        &quot;database.user&quot;: &quot;sa&quot;,
        &quot;database.password&quot;: &quot;test@12345678&quot;,
        &quot;database.dbname&quot;: &quot;shihu&quot;,
        &quot;database.server.name&quot;: &quot;fullfillment&quot;,
        &quot;table.whitelist&quot;: &quot;dbo.dt_test&quot;,
        &quot;database.history.kafka.bootstrap.servers&quot;: &quot;kafkaçš„IP:9092&quot;,
        &quot;database.history.kafka.topic&quot;: &quot;dbhistory.fullfillment&quot;,
        &quot;database.history.producer.security.protocol&quot;: &quot;SASL_PLAINTEXT&quot;,
        &quot;database.history.producer.sasl.mechanism&quot;: &quot;PLAIN&quot;,
        &quot;database.history.producer.sasl.jaas.config&quot;: &quot;org.apache.kafka.common.security.plain.PlainLoginModule required username=\&quot;admin\&quot; password=\&quot;123\&quot;;&quot;,
        &quot;database.history.consumer.security.protocol&quot;: &quot;SASL_PLAINTEXT&quot;,
        &quot;database.history.consumer.sasl.mechanism&quot;: &quot;PLAIN&quot;,
        &quot;database.history.consumer.sasl.jaas.config&quot;: &quot;org.apache.kafka.common.security.plain.PlainLoginModule required username=\&quot;admin\&quot; password=\&quot;123\&quot;;&quot;
    }
}'
</code></pre>
<h3 id="æ¶ˆè´¹ä¿¡æ¯">æ¶ˆè´¹ä¿¡æ¯</h3>
<h4 id="consumerprepertiesé…ç½®">consumer.prepertiesé…ç½®</h4>
<pre><code>bootstrap.servers=localhost:9092
group.id=test-consumer-group
security.protocol=SASL_PLAINTEXT
sasl.mechanism=PLAIN
</code></pre>
<h4 id="ä¿®æ”¹å™¨kafka-console-consumershä¸ºkafka-console-consumer-saalshå€’æ•°ç¬¬äºŒè¡Œæ·»åŠ ">ä¿®æ”¹å™¨kafka-console-consumer.shä¸ºkafka-console-consumer-saal.shå€’æ•°ç¬¬äºŒè¡Œæ·»åŠ </h4>
<pre><code>export KAFKA_OPTS=&quot;-Djava.security.auth.login.config=/opt/kafka/kafka_2.13-2.6.0/config/kafka_client_jaas.conf&quot;
</code></pre>
<h4 id="å¯åŠ¨">å¯åŠ¨</h4>
<pre><code>./bin/kafka-console-consumer-saal.sh --bootstrap-server localhost:9092 --topic fullfillment.dbo.dt_test --consumer.config config/consumer.properties
</code></pre>
<h4 id="æ¶ˆæ¯ç¤ºä¾‹">æ¶ˆæ¯ç¤ºä¾‹</h4>
<pre><code>{
    &quot;schema&quot;:{
        &quot;type&quot;:&quot;struct&quot;,
        &quot;fields&quot;:Array[6],
        &quot;optional&quot;:false,
        &quot;name&quot;:&quot;fullfillment.dbo.dt_test.Envelope&quot;
    },
    &quot;payload&quot;:{
        &quot;before&quot;:{
            &quot;tid&quot;:1,
            &quot;tname&quot;:&quot;222&quot;,
            &quot;tidcard&quot;:&quot;2&quot;,
            &quot;tbirthday&quot;:-25567,
            &quot;tmobile&quot;:&quot;1&quot;,
            &quot;temail&quot;:&quot;1&quot;,
            &quot;tgender&quot;:2,
            &quot;tcreate_time&quot;:-2208988800000
        },
        &quot;after&quot;:{
            &quot;tid&quot;:1,
            &quot;tname&quot;:&quot;test&quot;,
            &quot;tidcard&quot;:&quot;2&quot;,
            &quot;tbirthday&quot;:-25567,
            &quot;tmobile&quot;:&quot;1&quot;,
            &quot;temail&quot;:&quot;1&quot;,
            &quot;tgender&quot;:2,
            &quot;tcreate_time&quot;:-2208988800000
        },
        &quot;source&quot;:Object{...},
        &quot;op&quot;:&quot;u&quot;,
        &quot;ts_ms&quot;:1610019731750,
        &quot;transaction&quot;:null
    }
}
</code></pre>
<h4 id="oracleç¤ºä¾‹">oracleç¤ºä¾‹</h4>
<pre><code>
curl --location --request POST 'http://localhost:8083/connectors/' \
--header 'Content-Type: application/json' \
--data-raw '
{
    &quot;name&quot;: &quot;oracle-61-connector&quot;,
    &quot;config&quot;: {
        &quot;connector.class&quot;: &quot;com.ecer.kafka.connect.oracle.OracleSourceConnector&quot;,
        &quot;db.name.alias&quot;: &quot;61test&quot;,
        &quot;tasks.max&quot;: 1,
        &quot;topic&quot;: &quot;kol&quot;,
        &quot;db.name&quot;: &quot;portaldb&quot;,
        &quot;db.hostname&quot;: &quot;oralceè¿æ¥hoståœ°å€&quot;,
        &quot;db.port&quot;: 1521,
        &quot;db.user&quot;: &quot;info&quot;,
        &quot;db.user.password&quot;: &quot;111111&quot;,
        &quot;db.fetch.size&quot;: 1,
        &quot;table.whitelist&quot;: &quot;INFO.*,SPAUTH.*,WORKFLOW.*,FLOWABLE.*,OA.*&quot;,
        &quot;table.blacklist&quot;: &quot;&quot;,
        &quot;parse.dml.data&quot;: true,
        &quot;reset.offset&quot;: false,
        &quot;multitenant&quot;: false
    }
}
</code></pre>
<h3 id="mysqlç¤ºä¾‹">mysqlç¤ºä¾‹</h3>
<pre><code>curl --location --request POST 'http://localhost:8083/connectors/' \
--header 'Content-Type: application/json' \
--data-raw '
{
  &quot;name&quot;: &quot;140mysql-connector&quot;, 
  &quot;config&quot;: {
    &quot;connector.class&quot;: &quot;io.debezium.connector.mysql.MySqlConnector&quot;, 
    &quot;database.hostname&quot;: &quot;localhost&quot;, 
    &quot;database.port&quot;: &quot;3306&quot;, 
    &quot;database.user&quot;: &quot;root&quot;, 
    &quot;database.password&quot;: &quot;111111&quot;, 
    &quot;database.server.id&quot;: &quot;184054&quot;, 
    &quot;database.server.name&quot;: &quot;fullfillment140ms&quot;, 
    &quot;database.whitelist&quot;:&quot;test&quot;,
    &quot;database.history.kafka.bootstrap.servers&quot;: &quot;localhost:9092&quot;, 
    &quot;database.history.kafka.topic&quot;: &quot;dbhistory.fullfillment140ms&quot;, 
    &quot;include.schema.changes&quot;: &quot;false&quot;,
        &quot;database.history.producer.security.protocol&quot;: &quot;SASL_PLAINTEXT&quot;,
        &quot;database.history.producer.sasl.mechanism&quot;: &quot;PLAIN&quot;,
        &quot;database.history.producer.sasl.jaas.config&quot;: &quot;org.apache.kafka.common.security.plain.PlainLoginModule required username=\&quot;admin\&quot; password=\&quot;123\&quot;;&quot;,
        &quot;database.history.consumer.security.protocol&quot;: &quot;SASL_PLAINTEXT&quot;,
        &quot;database.history.consumer.sasl.mechanism&quot;: &quot;PLAIN&quot;,
        &quot;database.history.consumer.sasl.jaas.config&quot;: &quot;org.apache.kafka.common.security.plain.PlainLoginModule required username=\&quot;admin\&quot; password=\&quot;123\&quot;;&quot;
    }
}
</code></pre>
<h3 id="æŸ¥çœ‹topic-list">æŸ¥çœ‹topic list</h3>
<pre><code>bin/kafka-topics.sh --zookeeper localhost --list
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Kafkaå¼€å¯SASLç”¨æˆ·åå¯†ç è®¤è¯]]></title>
        <id>https://oldcamel.run/post/kafka-kai-qi-sasl-yong-hu-ming-mi-ma-ren-zheng/</id>
        <link href="https://oldcamel.run/post/kafka-kai-qi-sasl-yong-hu-ming-mi-ma-ren-zheng/">
        </link>
        <updated>2021-01-08T01:51:25.000Z</updated>
        <content type="html"><![CDATA[<h2 id="åˆ›å»ºkafka_server_jaasconfæ–‡ä»¶">åˆ›å»ºkafka_server_jaas.confæ–‡ä»¶</h2>
<p>configç›®å½•ä¸‹åˆ›å»ºkafka_server_jaas.confæ–‡ä»¶</p>
<pre><code>KafkaServer {
  org.apache.kafka.common.security.plain.PlainLoginModule required
  username=&quot;admin&quot;
  password=&quot;123&quot;
  user_admin=&quot;123&quot;
  user_yunzai=&quot;123&quot;;
};
</code></pre>
<h2 id="åˆ›å»ºkafka_client_jaasconfæ–‡ä»¶">åˆ›å»ºkafka_client_jaas.confæ–‡ä»¶</h2>
<p>configç›®å½•ä¸‹åˆ›å»ºkafka_client_jaas.confæ–‡ä»¶</p>
<pre><code>KafkaClient {
        org.apache.kafka.common.security.plain.PlainLoginModule required
        username=&quot;admin&quot;
        password=&quot;123&quot;;
};
</code></pre>
<h2 id="ä¿®æ”¹serverproperties">ä¿®æ”¹server.properties</h2>
<pre><code>listeners=SASL_PLAINTEXT://IP:9092
advertised.listeners=SASL_PLAINTEXT://IP:9092
security.inter.broker.protocol=SASL_PLAINTEXT
sasl.enabled.mechanisms=PLAIN
sasl.mechanism.inter.broker.protocol=PLAIN
authorizer.class.name = kafka.security.auth.SimpleAclAuthorizer
super.users=User:admin;
</code></pre>
<h2 id="ä¿®æ”¹kafakaå¯åŠ¨è„šæœ¬">ä¿®æ”¹kafakaå¯åŠ¨è„šæœ¬</h2>
<p>ä¿®æ”¹binç›®å½•ä¸‹kafka_start.sh<br>
åœ¨å€’æ•°ç¬¬äºŒè¡Œæ·»åŠ kafka_server_jaas.confçš„å…¨è·¯å¾„</p>
<pre><code>export KAFKA_OPTS=&quot;-Djava.security.auth.login.config=/opt/kafka/kafka_2.13-2.6.0/config/kafka_server_jaas.conf&quot;
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://oldcamel.run/post-images/1610071605941.png" alt="" loading="lazy"></figure>
<h2 id="å¯é€‰ä¸ºç‰¹å®šç”¨æˆ·æ·»åŠ ç‰¹å®štopicçš„aclæˆæƒ">ï¼ˆå¯é€‰ï¼‰ä¸ºç‰¹å®šç”¨æˆ·æ·»åŠ ç‰¹å®štopicçš„aclæˆæƒ</h2>
<p>å¦‚ä¸‹è¡¨ç¤ºä¸ºç”¨æˆ·yunzaiæ·»åŠ topic nginx-logçš„è¯»å†™æƒé™ã€‚</p>
<pre><code>./bin/kafka-acls.sh --authorizer-properties zookeeper.connect=localhost:2181 -add --allow-principal User:yunzai  --operation Read --operation Write --topic testyunzai
</code></pre>
<p>éªŒè¯æˆæƒ</p>
<pre><code>./bin/kafka-acls.sh --authorizer-properties zookeeper.connect=localhost:2181 --list --topic testyunzai
</code></pre>
<h3 id="ç”Ÿäº§è€…æ¶ˆè´¹è€…éªŒè¯">ç”Ÿäº§è€…æ¶ˆè´¹è€…éªŒè¯</h3>
<h4 id="ç”Ÿäº§è€…">ç”Ÿäº§è€…</h4>
<p>1.ä»¥ç”¨æˆ·yunzaiä¸ºä¾‹ï¼Œåˆ›å»ºJAASè®¤è¯æ–‡ä»¶yunzai_jaas.confæ”¾åœ¨configç›®å½•ä¸‹ï¼Œå†…å®¹å¦‚ä¸‹:</p>
<pre><code>KafkaClient {
org.apache.kafka.common.security.plain.PlainLoginModule required
username=&quot;yunzai&quot;
password=&quot;123&quot;;
};
</code></pre>
<p>2.æ‹·è´bin/kafka-console-producer.shä¸ºbin/yunzai-kafka-console-producer.shï¼Œå¹¶å°†JAASæ–‡ä»¶ä½œä¸ºä¸€ä¸ªJVMå‚æ•°ä¼ ç»™console producer</p>
<p>å€’æ•°ç¬¬äºŒè¡Œæ·»åŠ </p>
<pre><code>export KAFKA_OPTS=&quot;-Djava.security.auth.login.config=/opt/kafka/kafka_2.13-2.6.0/config/yunzai_jaas.conf&quot;
</code></pre>
<p>3.åˆ›å»ºæ–‡ä»¶producer.configæŒ‡å®šå¦‚ä¸‹å±æ€§ï¼š</p>
<pre><code>security.protocol=SASL_PLAINTEXT
sasl.mechanism=PLAIN
</code></pre>
<p>4.å¯åŠ¨producer</p>
<pre><code>./bin/yunzai-kafka-console-producer.sh --broker-list IP:9092 --topic testyunzai --producer.config producer.config
</code></pre>
<h4 id="æ¶ˆè´¹è€…">æ¶ˆè´¹è€…</h4>
<p>1.ä»¥ç”¨æˆ·yunzaiä¸ºä¾‹ï¼Œåˆ›å»ºJAASè®¤è¯æ–‡ä»¶yunzai_jaas.confæ”¾åœ¨configç›®å½•ä¸‹ï¼Œå¦‚æœç”¨æˆ·è·Ÿç”Ÿäº§è€…æ˜¯åŒä¸€ä¸ªï¼Œå¯ä»¥å¤ç”¨ä¸Šé¢ç”Ÿäº§è€…çš„JAASæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹:</p>
<pre><code>KafkaClient {
org.apache.kafka.common.security.plain.PlainLoginModule required
username=&quot;yunzai&quot;
password=&quot;123&quot;;
};
</code></pre>
<p>2.æ‹·è´bin/kafka-console-consumer.shä¸ºbin/yunzai-kafka-console-consumer.shï¼Œå¹¶å°†JAASæ–‡ä»¶ä½œä¸ºä¸€ä¸ªJVMå‚æ•°ä¼ ç»™console consumer<br>
å€’æ•°ç¬¬äºŒè¡Œæ·»åŠ </p>
<pre><code>export KAFKA_OPTS=&quot;-Djava.security.auth.login.config=/opt/kafka/kafka_2.13-2.6.0/config/yunzai_jaas.conf&quot;
</code></pre>
<p>3.åˆ›å»ºæ–‡ä»¶consumer.configæŒ‡å®šå¦‚ä¸‹å±æ€§ï¼š</p>
<pre><code>security.protocol=SASL_PLAINTEXT
sasl.mechanism=PLAIN
group.id=test
</code></pre>
<p>4.å¯åŠ¨consumer</p>
<pre><code>./bin/yunzai-kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic testyunzai --from-beginning --consumer.config consumer.config
</code></pre>
<h3 id="java-beamå®¢æˆ·ç«¯è®¤è¯">java beamå®¢æˆ·ç«¯è®¤è¯</h3>
<p>beamè®¾ç½®</p>
<pre><code class="language-java">   final Map&lt;String, Object&gt; immutableMap = new ImmutableMap.Builder&lt;String, Object&gt;()
                .put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, &quot;earliest&quot;)
                .put(ConsumerConfig.GROUP_ID_CONFIG, options.getGroupid())
                .put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, true)
                .put(CommonClientConfigs.SECURITY_PROTOCOL_CONFIG, &quot;SASL_PLAINTEXT&quot;)
                .put(SaslConfigs.SASL_MECHANISM, &quot;PLAIN&quot;)
                .put(SaslConfigs.SASL_JAAS_CONFIG, &quot;org.apache.kafka.common.security.plain.PlainLoginModule required username=\&quot;&quot; + options.getKafkaUsername() + &quot;\&quot; password=\&quot;&quot; + options.getKafkaPassword() + &quot;\&quot;;&quot;)
                .build();
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[VictoriaMetrics æ±‡æ€»å¤šä¸ªPrometheusæŒ‡æ ‡ï¼ˆå››ï¼‰è¯»å–IstioæŒ‡æ ‡]]></title>
        <id>https://oldcamel.run/post/victoriametrics-hui-zong-duo-ge-prometheus-zhi-biao-san-du-qu-istio-zhi-biao/</id>
        <link href="https://oldcamel.run/post/victoriametrics-hui-zong-duo-ge-prometheus-zhi-biao-san-du-qu-istio-zhi-biao/">
        </link>
        <updated>2020-12-25T07:41:53.000Z</updated>
        <content type="html"><![CDATA[<p>istioä¸­é»˜è®¤å¸¦äº†prometheus,é‡Œé¢åŒ…å«istioä»£ç†çš„æŒ‡æ ‡ï¼Œç°éœ€è¦å°†istioä¸­çš„æŒ‡æ ‡é…ç½®åœ¨kube-prometheusä¸­ã€‚</p>
<h2 id="ä¿®æ”¹prometheus-k8s-è§’è‰²æƒé™">ä¿®æ”¹prometheus-k8s è§’è‰²æƒé™</h2>
<p>ä¿®æ”¹prometheus-clusterRole.yaml</p>
<pre><code>apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: prometheus-k8s
rules:
- apiGroups:
  - &quot;&quot;
  resources:
  - nodes
  - services
  - endpoints
  - pods
  - nodes/proxy
  verbs:
  - get
  - watch
  - list
- apiGroups:
  - &quot;&quot;
  resources:
  - configmaps
  verbs:
  - get
- nonResourceURLs:
  - /metrics
  verbs:
  - get
</code></pre>
<h2 id="é…ç½®æ•°æ®å¹³é¢çš„æœåŠ¡ç›‘æ§">é…ç½®æ•°æ®å¹³é¢çš„æœåŠ¡ç›‘æ§</h2>
<pre><code>apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: prometheus-oper-istio-controlplane
spec:
  jobLabel: istio
  selector:
    matchExpressions:
      - {key: istio, operator: In, values: [mixer,pilot,galley,citadel,sidecar-injector]}
  namespaceSelector:
    any: true
  endpoints:
  - port: http-monitoring
    interval: 15s
  - port: http-policy-monitoring
    interval: 15s

</code></pre>
<h2 id="é…ç½®æ•°æ®å±‚çš„æœåŠ¡ç›‘æ§">é…ç½®æ•°æ®å±‚çš„æœåŠ¡ç›‘æ§</h2>
<pre><code>apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: prometheus-oper-istio-dataplane
  labels:
    monitoring: istio-dataplane
spec:
  selector:
    matchExpressions:
      - {key: istio-prometheus-ignore, operator: DoesNotExist}
  namespaceSelector:
    any: true
  jobLabel: envoy-stats
  endpoints:
  - path: /stats/prometheus
    targetPort: http-envoy-prom
    interval: 15s


</code></pre>
<h2 id="æŸ¥çœ‹æ˜¯å¦ç”Ÿæ•ˆ">æŸ¥çœ‹æ˜¯å¦ç”Ÿæ•ˆ</h2>
<figure data-type="image" tabindex="1"><img src="https://oldcamel.run/post-images/1608882536864.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="2"><img src="https://oldcamel.run/post-images/1608882571184.png" alt="" loading="lazy"></figure>
<h2 id="victoriametrics-ä¸­ä¸åŒé›†ç¾¤ä¸­çš„æŒ‡æ ‡è·å–">VictoriaMetrics ä¸­ä¸åŒé›†ç¾¤ä¸­çš„æŒ‡æ ‡è·å–</h2>
<figure data-type="image" tabindex="3"><img src="https://oldcamel.run/post-images/1608882968056.png" alt="" loading="lazy"></figure>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[VictoriaMetrics æ±‡æ€»å¤šä¸ªPrometheusæŒ‡æ ‡ï¼ˆä¸‰ï¼‰kube-prometheuså®‰è£…]]></title>
        <id>https://oldcamel.run/post/victoriametrics-hui-zong-duo-ge-prometheus-zhi-biao-san-kube-prometheus-an-zhuang/</id>
        <link href="https://oldcamel.run/post/victoriametrics-hui-zong-duo-ge-prometheus-zhi-biao-san-kube-prometheus-an-zhuang/">
        </link>
        <updated>2020-12-25T07:32:20.000Z</updated>
        <content type="html"><![CDATA[<p>kube-prometheusæ˜¯Prometheus Operator é’ˆå¯¹kubernetesçš„ç›‘æ§ç»„ä»¶ã€‚<br>
githubåœ°å€<br>
<a href="https://github.com/prometheus-operator/kube-prometheus">https://github.com/prometheus-operator/kube-prometheus</a></p>
<h2 id="é…ç½®è¿œç¨‹å†™å…¥">é…ç½®è¿œç¨‹å†™å…¥</h2>
<h3 id="basicç”¨æˆ·åå¯†ç é…ç½®-secret">basicç”¨æˆ·åå¯†ç é…ç½® secret</h3>
<pre><code>apiVersion: v1
kind: Secret
metadata:
  name: vmuser
  namespace: monitoring
type: kubernetes.io/basic-auth
stringData:
  username: username
  password: password
</code></pre>
<h3 id="æ·»åŠ è¿œç¨‹å†™å…¥-å’Œå¤–éƒ¨æ ‡ç­¾">æ·»åŠ è¿œç¨‹å†™å…¥ å’Œå¤–éƒ¨æ ‡ç­¾</h3>
<p>ä¿®æ”¹prometheus-prometheus.yamlæ–‡ä»¶ï¼Œæ·»åŠ </p>
<pre><code>prometheusExternalLabelName: &quot;&quot;
  replicaExternalLabelName: &quot;&quot;
  externalLabels:
    tenant: &quot;ç§Ÿæˆ·åç§°&quot;
  remoteWrite:
    - url: http://VictoriaMetricsè¿æ¥åœ°å€/api/v1/write
      basicAuth:
       username:
          key: username
          name: vmuser
       password:
          key: password
          name: vmuser
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[VictoriaMetrics æ±‡æ€»å¤šä¸ªPrometheusæŒ‡æ ‡ï¼ˆäºŒï¼‰Grafanaå®‰è£…]]></title>
        <id>https://oldcamel.run/post/grafana-an-zhuang/</id>
        <link href="https://oldcamel.run/post/grafana-an-zhuang/">
        </link>
        <updated>2020-12-25T06:50:09.000Z</updated>
        <content type="html"><![CDATA[<p>å®‰è£…grafana ä»victoriametricsä¸­è¯»å–æ±‡æ€»çš„æŒ‡æ ‡</p>
<h2 id="å®‰è£…mysql">å®‰è£…mysql</h2>
<h3 id="ä¸‹è½½ç¦»çº¿åŒ…">ä¸‹è½½ç¦»çº¿åŒ…</h3>
<p><a href="https://dev.mysql.com/downloads/mysql/5.7.html#downloads">ä¸‹è½½åœ°å€</a><br>
<img src="https://oldcamel.run/post-images/1608879483467.png" alt="" loading="lazy"></p>
<h3 id="è§£å‹å®‰è£…">è§£å‹å®‰è£…</h3>
<figure data-type="image" tabindex="1"><img src="https://oldcamel.run/post-images/1608879544128.png" alt="" loading="lazy"></figure>
<pre><code>rpm -Uvh *.rpm --nodeps --force
</code></pre>
<h3 id="ä¿®æ”¹é…ç½®æ–‡ä»¶">ä¿®æ”¹é…ç½®æ–‡ä»¶</h3>
<p>ä¿®æ”¹ /etc/my.cnf æ·»åŠ </p>
<pre><code>lower_case_table_names=1
default-storage-engine=INNODB
</code></pre>
<h3 id="ç”Ÿæˆç”¨æˆ·ä¸å¸¦å¯†ç ">ç”Ÿæˆç”¨æˆ·ä¸å¸¦å¯†ç </h3>
<pre><code>mysqld --initialize-insecure
</code></pre>
<p>å¦‚æœè¦é‡æ–°åˆå§‹åŒ–ï¼Œå¿…é¡»å…ˆæ¸…ç©ºdataæ–‡ä»¶å¤¹</p>
<h3 id="å¯åŠ¨mysql">å¯åŠ¨mysql</h3>
<pre><code>systemctl start mysqld
</code></pre>
<h3 id="è¿›å…¥mysql">è¿›å…¥mysql</h3>
<pre><code>mysql -u root
</code></pre>
<h3 id="ä¿®æ”¹å¯†ç å¼€å¯è¿œç¨‹è®¿é—®">ä¿®æ”¹å¯†ç +å¼€å¯è¿œç¨‹è®¿é—®</h3>
<pre><code>set password for root@localhost = password('123456');
GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY '123456' WITH GRANT OPTION;
FLUSH PRIVILEGES;
</code></pre>
<h3 id="åˆ›å»ºgrafanaæ•°æ®åº“">åˆ›å»ºgrafanaæ•°æ®åº“</h3>
<pre><code>CREATE DATABASE  `grafana` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
</code></pre>
<h2 id="å®‰è£…grafana">å®‰è£…grafana</h2>
<h3 id="ä¸‹è½½å®‰è£…">ä¸‹è½½å®‰è£…</h3>
<p><a href="https://grafana.com/grafana/download">å‚è€ƒæ–‡æ¡£</a></p>
<pre><code>wget https://dl.grafana.com/oss/release/grafana-7.3.6-1.x86_64.rpm
sudo yum install grafana-7.3.6-1.x86_64.rpm
</code></pre>
<h3 id="ä¿®æ”¹é…ç½®æ–‡ä»¶-2">ä¿®æ”¹é…ç½®æ–‡ä»¶</h3>
<pre><code class="language-shell">vim /etc/grafana/grafana.ini
</code></pre>
<h4 id="domainä¿®æ”¹">domainä¿®æ”¹</h4>
<pre><code>domain = ä¿®æ”¹æˆä¸»æœºIP
</code></pre>
<h4 id="é»˜è®¤ç”¨æˆ·åå¯†ç ä¿®æ”¹">é»˜è®¤ç”¨æˆ·åå¯†ç ä¿®æ”¹</h4>
<pre><code>admin_user = admin
admin_password = 123456
</code></pre>
<h4 id="æ•°æ®åº“ä¿®æ”¹">æ•°æ®åº“ä¿®æ”¹</h4>
<pre><code>type = mysql
host = 127.0.0.1:3306
name = grafana
user = root
password =123456

</code></pre>
<h3 id="å¯åŠ¨grafanaæœåŠ¡">å¯åŠ¨grafanaæœåŠ¡</h3>
<pre><code>service grafana-server start
</code></pre>
<h3 id="é…ç½®-victoriametricsè¿æ¥">é…ç½® victoriametricsè¿æ¥</h3>
<p>è®¿é—® ip:3000<br>
æ·»åŠ prometheusæ•°æ®æº è®¾ç½®ä¸º victoriametricsä¸»æœºip  ç«¯å£ 8428<br>
<img src="https://oldcamel.run/post-images/1608881141442.png" alt="" loading="lazy"></p>
<p>é…ç½®victoriametricså®˜æ–¹çš„ç›‘æ§å›¾è¡¨<br>
<a href="https://grafana.com/grafana/dashboards/10229">grafana labåœ°å€</a><br>
<img src="https://oldcamel.run/post-images/1608881288591.png" alt="" loading="lazy"></p>
]]></content>
    </entry>
</feed>